<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Rela Bot Control</title>
  <style>
    body { background:#0a0a0a; color:#eee; font-family:sans-serif; margin:0; }
    header { background:#111; padding:15px; text-align:center; color:#0ff; font-size:1.4em; }
    .container { padding:20px; max-width:900px; margin:auto; }
    .card { background:#111; border:1px solid #333; border-radius:10px; padding:15px; margin-bottom:20px; }
    input { width:100%; margin-bottom:10px; padding:8px; border-radius:6px; background:#222; color:#eee; border:1px solid #333; }
    button { background:#0ff; color:#000; border:none; padding:10px 16px; border-radius:6px; cursor:pointer; font-weight:bold; }
    button:hover { background:#09c; color:#fff; }
    .bot { background:#151515; border:1px solid #333; border-radius:8px; padding:10px; margin-top:10px; }
    .status.running { color:#0f0; }
    .status.stopped { color:#f33; }
  </style>
</head>
<body>
  <header>ðŸ¤– Rela Bot Control Center</header>
  <div class="container">
    <div class="card">
      <h3>Yangi bot yaratish</h3>
      <input id="name" placeholder="Bot nomi" />
      <input id="token" placeholder="Telegram token" />
      <button onclick="createBot()">Yaratish</button>
    </div>
    <div id="botList"></div>
  </div>

  <script>
    const API = location.origin + "/api";
    const ws = new WebSocket(`ws://${location.host}`);

    ws.onmessage = (e) => {
      const data = JSON.parse(e.data);
      console.log("WS:", data);
    };

    async function createBot() {
      const name = document.getElementById("name").value;
      const token = document.getElementById("token").value;
      if (!name || !token) return alert("Nom va token kerak!");

      const res = await fetch(API + "/create", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ name, token }),
      });
      const data = await res.json();
      if (data.ok) loadBots();
      else alert("Xatolik: " + data.error);
    }

    async function loadBots() {
      const res = await fetch(API + "/bots");
      const bots = await res.json();
      const div = document.getElementById("botList");
      div.innerHTML = bots.map(b => `
        <div class="bot">
          <b>${b.name}</b><br>
          <span class="status ${b.status}">${b.status}</span><br>
          <button onclick="startBot('${b.id}')">Start</button>
          <button onclick="stopBot('${b.id}')">Stop</button>
          <button onclick="deleteBot('${b.id}')">Delete</button>
        </div>
      `).join("");
    }

    async function startBot(id){await fetch(`${API}/bots/${id}/start`,{method:"POST"});loadBots();}
    async function stopBot(id){await fetch(`${API}/bots/${id}/stop`,{method:"POST"});loadBots();}
    async function deleteBot(id){await fetch(`${API}/bots/${id}`,{method:"DELETE"});loadBots();}

    loadBots();
  </script>
</body>
</html>